(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,function(t,e,c){"use strict";function i(t){const e=new Uint8Array(t),c=String.fromCharCode(...e);return console.log("string",c),c}function n(t){const e=t.length,c=new ArrayBuffer(e),i=new Uint8Array(c);for(let c=0;c<e;c++)i[c]=t.charCodeAt(c),console.log({i:c},i[c]);return c}c.d(e,"a",function(){return f}),c.d(e,"f",function(){return u}),c.d(e,"c",function(){return h}),c.d(e,"b",function(){return g}),c.d(e,"e",function(){return p}),c.d(e,"h",function(){return w}),c.d(e,"g",function(){return v}),c.d(e,"d",function(){return S});const s="00010000-89bd-43c8-9231-40f6e305f96d",r="00010001-89bd-43c8-9231-40f6e305f96d",o="00010002-89bd-43c8-9231-40f6e305f96d",a="00010005-89bd-43c8-9231-40f6e305f96d",b="00010004-89bd-43c8-9231-40f6e305f96d",l=!0,j=!1;let O,d;const f={COMPLETED:"COMPLETED",DISCONNECTED:"DISCONNECTED",SCANNING:"SCANNING",ASSOCIATING:"ASSOCIATING"};function u(){return!!navigator.bluetooth&&!!navigator.bluetooth.requestDevice}async function h(){return O=await navigator.bluetooth.requestDevice({filters:[{name:["IoT Gateway WiFi Setup"]}],optionalServices:[s]}),console.log("device",O),O}async function g(){return O?(d=await O.gatt.connect(),console.log("server",d),!0):(console.log("Device not established yet"),null)}async function p(){if(!d)return console.log("Server not established. Try to (re-)connect first."),null;const t=await d.getPrimaryService(s);console.log("service",t);const e=await t.getCharacteristic(b);console.log("characteristic",e);try{const t=await e.readValue();console.log("Wifi SSIDs value...",t);const c=i(t.buffer).split(" ");return console.log("ssids",c),c}catch(t){return console.error("Error getting SSIDs",t),null}}async function w(t){if(console.log("setWifiSSID",`"${t}"`),!d)return console.log("Server not established. Try to (re-)connect first."),j;const e=await d.getPrimaryService(s);console.log("service",e);const c=await e.getCharacteristic(r);console.log("characteristic",c);const i=n(t);console.log("Write buffer",i);try{const e=await c.writeValue(i);return console.log({response:e}),l}catch(e){console.error("Error setting wifi ssid",t,e)}return j}async function v(t){if(console.log("setWifiPassword",t),!d)return console.log("Server not established. Try to (re-)connect first."),null;const e=await d.getPrimaryService(s);console.log("service",e);const c=await e.getCharacteristic(o);console.log("characteristic",c);const i=n(t);console.log("Write buffer",i);try{const e=await c.writeValue(i);return console.log({response:e}),l}catch(e){console.error("Error setting wifi password",t,e)}return j}async function S(){if(console.log("getNetworkState"),!d)return console.log("Server not established. Try to (re-)connect first."),null;const t=await d.getPrimaryService(s);console.log("service",t);const e=await t.getCharacteristic(a);console.log("characteristic",e);try{const t=await e.readValue();console.log("Network status value...",t);const c=i(t.buffer);console.log("Network status string",c);const n=c.split(",");return n.length<2?(console.error("Invalid network status",c,n),null):{status:n[0],ipAddress:n[1]}}catch(t){return console.error("Error getting network state",t),null}}},function(t,e,c){"use strict";c.r(e);var i=c(0),n=c(1),s=c(3);var r={getIsValid(){return console.log("getIsValid: this.refs",this.refs.wifipwd,this.refs.wifissid),!!this.refs.wifissid.value&&!!this.refs.wifipwd.value},onWifiSSIDChange(){console.log("on wifi sssid change: this.refs",this.refs),this.set({isInvalid:!this.getIsValid()})},onWifiPwdChange(){console.log("on wifi pwd change: this.refs",this.refs),this.set({isInvalid:!this.getIsValid()})},async onSubmit(t){console.log("on submit!"),t.preventDefault(),this.set({waiting:!0});let e=await s.h(this.refs.wifissid.value);if(e&&(e=await s.g(this.refs.wifipwd.value)),e){const t=await s.d();console.log("state",t),console.log("status",t.status),console.log("ipAddress",t.ipAddress),this.store.set({ipAddress:t.ipAddress}),e=t.status===s.a.COMPLETED}e?(console.log("COMPLETED"),Object(n.a)("/redirect")):this.set({error:!0}),this.set({waiting:!1})}};function o(t,e){var c,n,s,r,o;return{c(){c=Object(i.m)("h3"),n=Object(i.n)("There was a problem connecting to your Gateway. Please "),s=Object(i.m)("a"),r=Object(i.n)("start again"),o=Object(i.n)("."),this.h()},l(t){c=Object(i.j)(t,"H3",{class:!0},!1);var e=Object(i.i)(c);n=Object(i.k)(e,"There was a problem connecting to your Gateway. Please "),s=Object(i.j)(e,"A",{href:!0},!1);var a=Object(i.i)(s);r=Object(i.k)(a,"start again"),a.forEach(i.p),o=Object(i.k)(e,"."),e.forEach(i.p),this.h()},h(){s.href="/",c.className="error"},m(t,e){Object(i.u)(c,t,e),Object(i.d)(n,c),Object(i.d)(s,c),Object(i.d)(r,s),Object(i.d)(o,c)},d(t){t&&Object(i.p)(c)}}}function a(t,e){var c,n,s,r=e.wifiSSID;return{c(){c=Object(i.m)("option"),n=Object(i.n)(r),this.h()},l(t){c=Object(i.j)(t,"OPTION",{value:!0},!1);var e=Object(i.i)(c);n=Object(i.k)(e,r),e.forEach(i.p),this.h()},h(){c.__value=s=e.wifiSSID,c.value=c.__value},m(t,e){Object(i.u)(c,t,e),Object(i.d)(n,c)},p(t,e){t.$wifiSSIDs&&r!==(r=e.wifiSSID)&&(n.data=r),t.$wifiSSIDs&&s!==(s=e.wifiSSID)&&(c.__value=s),c.value=c.__value},d(t){t&&Object(i.p)(c)}}}function b(t,e){var c,n;return{c(){c=Object(i.m)("button"),n=Object(i.m)("span"),this.h()},l(t){c=Object(i.j)(t,"BUTTON",{id:!0,disabled:!0,class:!0},!1);var e=Object(i.i)(c);n=Object(i.j)(e,"SPAN",{class:!0},!1),Object(i.i)(n).forEach(i.p),e.forEach(i.p),this.h()},h(){n.className="loadingSpinner",c.id="submit",c.disabled=!0,c.className="svelte-15q61ds"},m(t,e){Object(i.u)(c,t,e),Object(i.d)(n,c)},p:i.v,d(t){t&&Object(i.p)(c)}}}function l(t,e){var c,n;return{c(){c=Object(i.m)("button"),n=Object(i.n)("Submit"),this.h()},l(t){c=Object(i.j)(t,"BUTTON",{id:!0,disabled:!0,class:!0},!1);var e=Object(i.i)(c);n=Object(i.k)(e,"Submit"),e.forEach(i.p),this.h()},h(){c.id="submit",c.disabled=e.isInvalid,c.className="svelte-15q61ds"},m(t,e){Object(i.u)(c,t,e),Object(i.d)(n,c)},p(t,e){t.isInvalid&&(c.disabled=e.isInvalid)},d(t){t&&Object(i.p)(c)}}}function j(t,e,c){const i=Object.create(t);return i.wifiSSID=e[c],i.each_value=e,i.wifiSSID_index=c,i}function O(t){if(Object(i.t)(this,t),this.refs={},this._state=Object(i.e)(Object(i.e)(this.store._init(["wifiSSIDs"]),{isInvalid:!0,error:!1,waiting:!1}),t.data),this.store._add(this,["wifiSSIDs"]),this._intro=!0,this._handlers.destroy=[i.y],document.getElementById("svelte-15q61ds-style")||function(){var t=Object(i.m)("style");t.id="svelte-15q61ds-style",t.textContent="#wifi-ssid.svelte-15q61ds{width:100%}#submit.svelte-15q61ds{width:100%}",Object(i.d)(t,document.head)}(),this._fragment=function(t,e){for(var c,n,s,r,O,d,f,u,h,g,p,w,v,S,m,E,I,y,D,k,N,T,C,_,P,A,W,F,q,G,L,V,B,M,$,U,z=e.error&&o(),x=e.$wifiSSIDs,H=[],J=0;J<x.length;J+=1)H[J]=a(0,j(e,x,J));function R(e){t.onWifiSSIDChange()}function Y(e){t.onWifiPwdChange()}function K(e){t.onWifiPwdChange()}function Q(t){return t.waiting?b:l}var X=Q(e),Z=X(t,e);function tt(e){t.onSubmit(e)}return{c(){c=Object(i.n)("\n\n\n\n"),n=Object(i.m)("h1"),s=Object(i.m)("a"),r=Object(i.n)("Setup "),O=Object(i.m)("strong"),d=Object(i.n)("Things"),f=Object(i.n)(" "),u=Object(i.m)("img"),h=Object(i.n)("\n\n"),g=Object(i.m)("h2"),p=Object(i.n)("Step 2"),w=Object(i.n)("\n\n"),z&&z.c(),v=Object(i.n)("\n\n"),S=Object(i.m)("p"),m=Object(i.n)("Your Wi-Fi details"),E=Object(i.n)("\n\n"),I=Object(i.m)("form"),y=Object(i.m)("p"),D=Object(i.m)("label"),k=Object(i.n)("Wi-Fi name (SSID)"),N=Object(i.n)("\n\t\t"),T=Object(i.m)("select"),C=Object(i.m)("option"),_=Object(i.n)("Select...");for(var t=0;t<H.length;t+=1)H[t].c();P=Object(i.n)("\n\n\t"),A=Object(i.m)("p"),W=Object(i.m)("label"),F=Object(i.n)("Wi-Fi password"),q=Object(i.n)("\n\t\t"),G=Object(i.m)("input"),L=Object(i.n)("\n\n\t"),V=Object(i.m)("p"),Z.c(),B=Object(i.n)("\n\n"),M=Object(i.m)("p"),$=Object(i.m)("a"),U=Object(i.n)("Start again"),this.h()},l(t){c=Object(i.k)(t,"\n\n\n\n"),n=Object(i.j)(t,"H1",{},!1);var e=Object(i.i)(n);s=Object(i.j)(e,"A",{href:!0},!1);var o=Object(i.i)(s);r=Object(i.k)(o,"Setup "),O=Object(i.j)(o,"STRONG",{},!1);var a=Object(i.i)(O);d=Object(i.k)(a,"Things"),a.forEach(i.p),f=Object(i.k)(o," "),u=Object(i.j)(o,"IMG",{src:!0,alt:!0,width:!0,height:!0},!1),Object(i.i)(u).forEach(i.p),o.forEach(i.p),e.forEach(i.p),h=Object(i.k)(t,"\n\n"),g=Object(i.j)(t,"H2",{},!1);var b=Object(i.i)(g);p=Object(i.k)(b,"Step 2"),b.forEach(i.p),w=Object(i.k)(t,"\n\n"),z&&z.l(t),v=Object(i.k)(t,"\n\n"),S=Object(i.j)(t,"P",{class:!0},!1);var l=Object(i.i)(S);m=Object(i.k)(l,"Your Wi-Fi details"),l.forEach(i.p),E=Object(i.k)(t,"\n\n"),I=Object(i.j)(t,"FORM",{},!1);var j=Object(i.i)(I);y=Object(i.j)(j,"P",{},!1);var x=Object(i.i)(y);D=Object(i.j)(x,"LABEL",{for:!0},!1);var J=Object(i.i)(D);k=Object(i.k)(J,"Wi-Fi name (SSID)"),J.forEach(i.p),N=Object(i.k)(x,"\n\t\t"),T=Object(i.j)(x,"SELECT",{id:!0,class:!0},!1);var R=Object(i.i)(T);C=Object(i.j)(R,"OPTION",{value:!0,selected:!0},!1);var Y=Object(i.i)(C);_=Object(i.k)(Y,"Select..."),Y.forEach(i.p);for(var K=0;K<H.length;K+=1)H[K].l(R);R.forEach(i.p),x.forEach(i.p),P=Object(i.k)(j,"\n\n\t"),A=Object(i.j)(j,"P",{},!1);var Q=Object(i.i)(A);W=Object(i.j)(Q,"LABEL",{for:!0},!1);var X=Object(i.i)(W);F=Object(i.k)(X,"Wi-Fi password"),X.forEach(i.p),q=Object(i.k)(Q,"\n\t\t"),G=Object(i.j)(Q,"INPUT",{type:!0,id:!0},!1),Object(i.i)(G).forEach(i.p),Q.forEach(i.p),L=Object(i.k)(j,"\n\n\t"),V=Object(i.j)(j,"P",{},!1);var tt=Object(i.i)(V);Z.l(tt),tt.forEach(i.p),j.forEach(i.p),B=Object(i.k)(t,"\n\n"),M=Object(i.j)(t,"P",{class:!0},!1);var et=Object(i.i)(M);$=Object(i.j)(et,"A",{href:!0},!1);var ct=Object(i.i)($);U=Object(i.k)(ct,"Start again"),ct.forEach(i.p),et.forEach(i.p),this.h()},h(){document.title="Setup Things - Step 2",u.src="logo-light.svg",u.alt="Things logo",u.width="50",u.height="50",s.href="/",S.className="instruction",D.htmlFor="wifi-ssid",C.__value="",C.value=C.__value,C.selected=!0,Object(i.c)(T,"change",R),T.id="wifi-ssid",T.className="svelte-15q61ds",W.htmlFor="wifi-pwd",Object(i.c)(G,"input",Y),Object(i.c)(G,"change",K),Object(i.A)(G,"type","password"),G.id="wifi-pwd",Object(i.c)(I,"submit",tt),$.href="/",M.className="footer"},m(e,o){Object(i.u)(c,e,o),Object(i.u)(n,e,o),Object(i.d)(s,n),Object(i.d)(r,s),Object(i.d)(O,s),Object(i.d)(d,O),Object(i.d)(f,s),Object(i.d)(u,s),Object(i.u)(h,e,o),Object(i.u)(g,e,o),Object(i.d)(p,g),Object(i.u)(w,e,o),z&&z.m(e,o),Object(i.u)(v,e,o),Object(i.u)(S,e,o),Object(i.d)(m,S),Object(i.u)(E,e,o),Object(i.u)(I,e,o),Object(i.d)(y,I),Object(i.d)(D,y),Object(i.d)(k,D),Object(i.d)(N,y),Object(i.d)(T,y),Object(i.d)(C,T),Object(i.d)(_,C);for(var a=0;a<H.length;a+=1)H[a].m(T,null);t.refs.wifissid=T,Object(i.d)(P,I),Object(i.d)(A,I),Object(i.d)(W,A),Object(i.d)(F,W),Object(i.d)(q,A),Object(i.d)(G,A),t.refs.wifipwd=G,Object(i.d)(L,I),Object(i.d)(V,I),Z.m(V,null),Object(i.u)(B,e,o),Object(i.u)(M,e,o),Object(i.d)($,M),Object(i.d)(U,$)},p(e,c){if(c.error?z||((z=o()).c(),z.m(v.parentNode,v)):z&&(z.d(1),z=null),e.$wifiSSIDs){x=c.$wifiSSIDs;for(var i=0;i<x.length;i+=1){const t=j(c,x,i);H[i]?H[i].p(e,t):(H[i]=a(0,t),H[i].c(),H[i].m(T,null))}for(;i<H.length;i+=1)H[i].d(1);H.length=x.length}X===(X=Q(c))&&Z?Z.p(e,c):(Z.d(1),(Z=X(t,c)).c(),Z.m(V,null))},d(e){e&&(Object(i.p)(c),Object(i.p)(n),Object(i.p)(h),Object(i.p)(g),Object(i.p)(w)),z&&z.d(e),e&&(Object(i.p)(v),Object(i.p)(S),Object(i.p)(E),Object(i.p)(I)),Object(i.o)(H,e),Object(i.z)(T,"change",R),t.refs.wifissid===T&&(t.refs.wifissid=null),Object(i.z)(G,"input",Y),Object(i.z)(G,"change",K),t.refs.wifipwd===G&&(t.refs.wifipwd=null),Z.d(),Object(i.z)(I,"submit",tt),e&&(Object(i.p)(B),Object(i.p)(M))}}}(this,this._state),t.target){var e=Object(i.i)(t.target);t.hydrate?this._fragment.l(e):this._fragment.c(),e.forEach(i.p),this._mount(t.target,t.anchor)}}Object(i.e)(O.prototype,i.x),Object(i.e)(O.prototype,r),e.default=O}]]);